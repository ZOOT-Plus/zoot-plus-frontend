@import './tailwind.css';

@primary-color: theme('colors.violet.500');
@info-color: theme('colors.sky.500');
@danger-color: theme('colors.red.500');
@success-color: theme('colors.emerald.500');
@warning-color: theme('colors.amber.500');

// 加上最外层的id，保证自定义css优先级
body {
  .bp4-card {
    @apply rounded-lg py-4;
  }

  .bp4-input {
    @apply block w-full py-2 pl-3 pr-3;
    @apply bg-white shadow-sm border border-slate-400 rounded-md border-solid;
    @apply focus:border-violet-500 focus:outline-none;

    &:focus {
      box-shadow: 0 0 3px @primary-color;
    }

    &[type='search' i]::-webkit-search-cancel-button {
      @apply mr-0 cursor-pointer;
    }
  }

  .bp4-input,
  // class of TagInput (also used by MultiSelect2)
  .bp4-input-ghost {
    @apply placeholder:italic placeholder:text-slate-400;
  }

  // simulate border using outline because Blueprint TextArea's auto-sizing doesn't work well with border
  textarea.bp4-input {
    @apply border-none outline outline-1 outline-slate-400;

    outline-offset: -1px;
  }

  .bp4-file-upload-input {
    @apply placeholder:italic placeholder:text-slate-400;
    @apply block w-full;
    @apply bg-white shadow-sm border border-slate-400 rounded-md border-solid;
    @apply focus:border-violet-500 focus:outline-none;

    &:focus {
      box-shadow: 0 0 0 3px @primary-color;
    }
  }

  .bp4-large .bp4-file-upload-input::after {
    @apply m-1;
  }

  .bp4-callout {
    @apply rounded-md;
  }

  .bp4-input-group {
    .bp4-icon {
      @apply absolute inset-y-0 left-0 flex items-center m-0;

      span {
        @apply h-5 w-5;
      }
    }

    .bp4-button .bp4-icon {
      @apply relative;
    }

    .bp4-icon + .bp4-input {
      @apply pl-8;
    }
  }

  .bp4-large .bp4-file-upload-input {
    line-height: 2.375rem;
  }

  .bp4-large .bp4-file-upload-input::after {
    @apply text-slate-900 shadow-none rounded-none m-0;
    @apply border-l border-solid border-slate-400;
    @apply hover:shadow-none;

    height: 2.375rem;
    line-height: 2.375rem;
  }

  .bp4-button {
    @apply flex;
    @apply border border-solid border-transparent rounded-md font-semibold;
    @apply text-sm;
    @apply transition-colors;
    @apply justify-center items-center;

    &:not(.bp4-small) {
      @apply py-2 px-4;
    }

    &:not([class*='bp4-intent-']):not(.bp4-minimal) {
      @apply text-slate-900 shadow-none;
      @apply border-slate-400;
      @apply hover:shadow-none;
    }

    &.bp4-disabled {
      @apply opacity-50;
    }

    &.bp4-intent-primary {
      &,
      &.bp4-disabled {
        @apply bg-violet-500 enabled:hover:bg-violet-600;
      }
      &.bp4-minimal {
        @apply bg-transparent enabled:hover:bg-violet-100;
      }
    }

    &.bp4-intent-success {
      &,
      &.bp4-disabled {
        @apply bg-emerald-500 enabled:hover:bg-emerald-600;
      }
      &.bp4-minimal {
        @apply bg-transparent enabled:hover:bg-emerald-100;
      }
    }

    &.bp4-intent-warning {
      &,
      &.bp4-disabled {
        @apply bg-amber-500 enabled:hover:bg-amber-600;
      }
      &.bp4-minimal {
        @apply bg-transparent enabled:hover:bg-amber-100;
      }
    }

    &.bp4-intent-danger {
      &,
      &.bp4-disabled {
        @apply bg-red-500 enabled:hover:bg-red-600;
      }
      &.bp4-minimal {
        @apply bg-transparent enabled:hover:bg-red-100;
      }
    }

    .bp4-icon:first-child {
      @apply mr-2;
    }
  }

  // TODO: 请把select换成组件库的select
  // .bp4-html-select select {
  //   @apply block py-2 px-4;
  //   @apply border border-solid border-slate-400 rounded-md font-semibold;
  //   @apply text-sm shadow-none text-center;
  //   @apply transition-colors;
  //   @apply focus:outline-none;
  // }

  .bp4-popover2 {
    @apply rounded-lg;
    .bp4-popover2-content {
      @apply rounded-lg p-2;
    }
    ul li {
      .bp4-menu-item {
        @apply rounded-md;
      }

      &:not(:last-child) {
        @apply mb-1;
      }
    }
  }

  .bp4-dialog {
    @apply rounded-lg;
    & .bp4-dialog-header {
      @apply rounded-t-lg;
    }
  }

  .bp4-popover2 .bp4-heading {
    @apply opacity-80;
  }

  .bp4-toast {
    @apply rounded border-none;
    &.bp4-intent-success {
      @apply bg-emerald-500;
      .bp4-button {
        @apply !bg-emerald-500;
      }
    }
    &.bp4-intent-warning {
      @apply bg-amber-500;
      .bp4-button {
        @apply !bg-amber-500;
      }
    }
    &.bp4-intent-danger {
      @apply bg-red-500;
      .bp4-button {
        @apply !bg-red-500;
      }
    }
    .bp4-button {
      @apply border-none p-0;
    }
  }

  .bp4-numeric-input {
    & .bp4-input-group {
      @apply !mr-0;

      & input {
        @apply rounded-r-none border-r-0;
      }
    }

    & .bp4-button-group {
      & button {
        @apply !rounded-l-none;
      }
      & button:first-of-type {
        @apply !rounded-tr-lg;
      }
      & button:last-of-type {
        @apply !rounded-br-lg;
      }
    }
  }

  .bp4-skeleton {
    @apply rounded-md;
  }

  label.bp4-checkbox {
    @apply select-none;
  }
}

.bp4-dark {
  @dark-content-bg: #18181c;

  // background
  .docs-content-wrapper {
    @apply min-h-screen;
    background-color: @dark-content-bg;
  }

  // navbar
  .bp4-navbar {
    background-color: #232326;
    border-bottom: 1px solid #38383b;

    a,
    .bp4-tag span {
      @apply text-slate-50;
    }
  }

  // 首页右侧友情链接
  .section-social-links {
    svg {
      color: #8abbff;
    }

    span:hover {
      @apply text-slate-50;
    }
  }

  .bp4-dialog,
  .bp4-drawer,
  .bp4-menu{
    background-color: #232326;
    border: 1px solid #38383b;
    color: #e0e0e0;
  }

  .bp4-card {
    background-color: #232326;
    color: #e0e0e0;
  }

  .bp4-drawer {
    .bg-slate-100,
    .dark\:bg-slate-900 {
      background-color: #232326 !important;

      border-bottom: 1px solid #38383b !important;

      color: #e0e0e0 !important;

      box-shadow: none !important;
    }
  }

  .bp4-popover2 .bp4-popover2-content,
  .bp4-popover2.bp4-dark .bp4-popover2-content {
    background-color: #232326 !important;
    border: 1px solid #38383b !important;
    color: #e0e0e0 !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5) !important;
  }

  .bp4-popover2 .bp4-popover2-arrow-fill {
    fill: #232326 !important;
  }
  .bp4-popover2 .bp4-popover2-arrow-border {
    fill: #38383b !important;
  }

  .bp4-popover2-content {
    // 1. 让内部的 Menu 背景透明 (复用 Popover 的背景)，并去除多余边框
    .bp4-menu {
      background-color: transparent;
      border: none;
    }

    // 2. 修正顶部的搜索框容器 (Input Group)
    .bp4-input-group {
      // 搜索框背景色 #2d2d30 (深灰 hover 色)，与弹窗背景 #232326 区分开
      .bp4-input {
        background-color: #2d2d30;
        border: 1px solid #38383b;
        color: #ffffff;
        box-shadow: none; // 去除白色阴影

        &:focus {
          border-color: @primary-color;
        }

        &::placeholder {
          color: #6b7280;
        }
      }

      // 搜索图标颜色
      .bp4-icon {
        color: #9ca3af;
        background-color: transparent;
      }
    }
  }

  .bp4-input,
  textarea,
  .bp4-file-upload-input {
    background-color: #2d2d30;
    border-color: #38383b;
    color: #fff;
  }

  // 作业详情页
  .bp4-card p,
  .bp4-card div,
  .markdown-body,
  .markdown-body span {
    @apply text-slate-100;
  }

  .markdown-body blockquote {
    @apply bg-zinc-900;
  }

  .markdown-body a {
    color: #a78bfa; // violet-400
  }

  .markdown-body pre,
  .markdown-body code {
    background-color: #2d2d30;
    color: #e0e0e0;
  }

  .markdown-body blockquote {
    @apply bg-zinc-900;
  }

  // 通用样式 - 按钮、tag、提示
  .bp4-button {
    &:not([class*='bp4-intent-']):not(.bp4-minimal) {
      background-color: #2d2d30;
      border-color: #38383b;

      &:hover {
        background-color: #3e3e42;
      }
    }

    .bp4-button-text {
      @apply text-slate-50;
    }

    &.bp4-minimal.bp4-intent-danger:hover:enabled {
      @apply bg-red-500;
    }
  }

  .bp4-tag {
    background-color: #333 !important;
    border: 1px solid #444 !important;
    color: #e0e0e0 !important;

    &.bp4-intent-danger,
    &.bg-red-400 {
      background-color: #4a1e1e !important;
      border-color: #7f1d1d !important;
      color: #fca5a5 !important;
    }

    &.bp4-intent-primary,
    &.bg-violet-400 {
      background-color: #4c1d95 !important; // violet-900
      border-color: #6d28d9 !important;     // violet-700
      color: #ddd6fe !important;            // violet-200
    }

    // 交互状态微调
    &:hover {
      opacity: 0.9;
    }
  }

  .bp4-tooltip2 {

    .bp4-popover2-content {
      background-color: #232326 !important;
      border: 1px solid #38383b !important;

      color: #e0e0e0 !important;

      > div,
      > span {
        color: #e0e0e0 !important;
      }
    }

    .bp4-popover2-arrow-fill {
      fill: #232326 !important;
    }
    .bp4-popover2-arrow-border {
      fill: #38383b !important;
    }
  }

  .bp4-callout p {
    @apply text-slate-50;
  }

  .bp4-label {
    p,
    span,
    div {
      @apply text-slate-100;
    }
  }

  .bp4-text-muted {
    @apply text-slate-100;
  }

  .bp4-menu {
    .bp4-menu-item:hover,
    .bp4-menu-item.bp4-active,
    .bp4-menu-item.bp4-selected {
      @apply text-slate-100;
      background-color: rgba(139, 92, 246, 0.15) !important;
    }
  }

  .bp4-form-group {
    .bp4-form-helper-text {
      @apply text-slate-100;
    }

    .bp4-input-group input {
      @apply text-slate-100;
    }
  }

  .bp4-tabs {
    div,
    span,
    p {
      @apply text-slate-100;
    }
  }

  .bg-slate-100.ring-slate-200 {
    background-color: #2d2d30 !important;
    --tw-ring-color: #38383b !important;
    box-shadow: inset 0 0 0 2px #38383b !important;
    color: #52525b !important; // Zinc-600
  }

  h4.bg-gray-100 {
    background-color: #2d2d30 !important;

    &.text-slate-900 {
      color: #e0e0e0 !important;
    }
  }

  .dark\:bg-\[\#383e47\] {
    background-color: #232326 !important;
    border-bottom: 1px solid #38383b !important;
    color: #e0e0e0 !important;
  }

  // 创建作业悬浮地图的标题栏
  .floating-map-header {
    background-color: #2d2d30 !important;
    color: #e0e0e0 !important;
    border-bottom: 1px solid #38383b !important;
  }

  .bp4-file-upload-input {
    box-shadow: inset 0 0 0 1px #38383b !important;
    background-color: #2d2d30 !important;
    color: #e0e0e0 !important;
  }

  // 上传本地作业按钮
  .bp4-file-upload-input::after {
    background-color: #2d2d30 !important;
    border-left: 1px solid #38383b !important;
    color: #e0e0e0 !important;
    box-shadow: none !important;
  }
  .bp4-file-input:hover .bp4-file-upload-input::after {
    background-color: #3e3e42 !important;
  }

  .bp4-input,
  textarea.bp4-input,
  input.bp4-input {
    background-color: #2d2d30 !important;
    box-shadow: inset 0 0 0 1px #38383b !important;
    color: #ffffff !important;
    &::placeholder {
      color: #6b7280 !important;
    }
    &:disabled,
    &.bp4-disabled {
      background-color: #202023 !important;
      box-shadow: none !important;
      color: #71717a !important;
    }
  }

  .bp4-input:focus,
  .bp4-input.bp4-active,
  textarea.bp4-input:focus,
  textarea.bp4-input.bp4-active {
    border-color: #8b5cf6 !important;
    box-shadow: inset 0 0 0 1px #8b5cf6, 0 0 0 2px rgba(139, 92, 246, 0.3) !important;
    background-color: #2d2d30 !important;
    outline: none !important;
  }

  .bp4-dialog-header {
    background-color: #232326 !important;
    border-bottom: 1px solid #38383b !important;
    color: #e0e0e0 !important;
    box-shadow: none !important;
  }

  .bp4-dialog-close-button .bp4-icon {
    color: #9ca3af !important;
    &:hover {
      color: #ffffff !important;
    }
  }
}
